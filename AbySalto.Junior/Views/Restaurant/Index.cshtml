@model AbySalto.Junior.ViewModels.IndexOrderViewModel

@{
    ViewData["Title"] = "Narudžbe";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row mb-4">
    <div class="col-md-6">
        <h2>Lista narudžbi</h2>
    </div>
    <div class="col-md-6 text-end">
        <a href="/Restaurant/Create" class="btn btn-success">
            <i class="bi bi-plus-circle"></i> Dodaj novu narudžbu
        </a>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table id="ordersTable" class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Kupac</th>
                        <th>Status</th>
                        <th>Ukupan iznos</th>
                        <th>Datum narudžbe</th>
                        <th>Kontakt</th>
                        <th>Akcije</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var order in Model.Orders)
                    {
                        <tr>
                            <td><strong>#@order.Id</strong></td>
                            <td>@order.CustomerName</td>
                            <td>
                                <span class="badge bg-info">@order.OrderStatus.Name</span>
                            </td>
                            <td><strong>@order.TotalAmount.ToString("F2") @order.Currency</strong></td>
                            <td>@order.OrderTime.ToString("dd.MM.yyyy HH:mm")</td>
                            <td>@order.ContactNumber</td>
                            <td>
                                <button type="button" class="btn btn-sm btn-primary js-showOrderDetails"
                                        data-order-id="@order.Id">
                                    Detalji
                                </button>
                                <a href="/Restaurant/Edit/@order.Id" class="btn btn-sm btn-warning">Uredi</a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

//modali
<div class="modal fade" id="orderDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" id="modalContent">
        </div>
    </div>
</div>


@section Scripts {
    <script>
        $(document).ready(function() {
            $('#ordersTable').DataTable({
                "language": {
                    "search": "Pretraži:",
                    "lengthMenu": "Prikaži _MENU_ zapisa po stranici",
                    "info": "Prikazujem _START_ do _END_ od ukupno _TOTAL_ zapisa",
                    "paginate": {
                        "first": "Prva",
                        "last": "Zadnja",
                        "next": "Sljedeća",
                        "previous": "Prethodna"
                    }
                },
                "order": [[ 4, "desc" ]],
                "pageLength": 10
            });

            $(document).on('click', '.js-showOrderDetails', function() {
                var orderId = $(this).data('order-id');
                var url = '@Url.Action("OrderDetailsModal", "Restaurant")';

                $.get(url, { id: orderId })
                    .done(function(data) {
                        $('#modalContent').html(data);
                        $('#orderDetailsModal').modal('show');
                    })
                    .fail(function() {
                        alert('Greška prilikom učitavanja detalja narudžbe');
                    });
            });
        });
    </script>
}